<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>小下同学 - 找不到北，就多看东西</title><meta name="author" content="安小下同学"><meta name="copyright" content="安小下同学"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="小下同学">
<meta property="og:url" content="https://blog.linganmin.cn/page/3/index.html">
<meta property="og:site_name" content="小下同学">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://graph.linganmin.cn/200118/06177d8b92c66f2c3a6fd82cca544f51">
<meta property="article:author" content="安小下同学">
<meta property="article:tag" content="安小下同学,闵令安,令安,小下,亲爱的安小下同学,小下同学,小小小下,前端,js,jquery,javascript,html5,开发者,程序猿,程序媛,极客,编程,代码,开源,IT网站,Developer,Programmer,Coder,Geek,html,css,css3,用户体验,php,laravel,golang,phper,docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://graph.linganmin.cn/200118/06177d8b92c66f2c3a6fd82cca544f51"><link rel="shortcut icon" href="https://graph.linganmin.cn/201206/fe9c5e8ef76354659ab9c6c8764d6f3d"><link rel="canonical" href="https://blog.linganmin.cn/page/3/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="KrvBZb2kkH"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/pluginsSrc/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b4e74da1cb3c8b4a65da55116b8cba6f";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.min.js',
      css: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '小下同学',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-05-01 10:27:17'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://graph.linganmin.cn/200118/06177d8b92c66f2c3a6fd82cca544f51" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://graph.linganmin.cn/200120/81525dc7a1a92645199b36b2e20cc2c8?x-oss-process=image/format,webp/quality,q_40')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">小下同学</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">小下同学</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/linganmin" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:saboranmin@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.weibo.com/u/1793963601" target="_blank" title="Weibo"><i class="fab fa-weibo"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/posts/330d259a/" title="类微博/微信朋友圈 feed 流系统设计"><img class="post_bg" src="https://graph.linganmin.cn/210410/1e1052bedd6dfa45b8c8626bec224ed2?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="类微博/微信朋友圈 feed 流系统设计"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/330d259a/" title="类微博/微信朋友圈 feed 流系统设计">类微博/微信朋友圈 feed 流系统设计</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-04-06T23:30:20.000Z" title="发表于 2021-04-07 07:30:20">2021-04-07</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/">系统架构</a></span></div><div class="content">
写扩散(push)
为每个用户维护一个订阅列表，记录该用订阅&#x2F;关注的用户的消息的索引(一般为消息ID、类型、发布时间等基础数据)。

读扩散 (pull)
为每个用户维护一个发送列表，记录这个用户所有发布的消息索引。

混合模式 (push + pull)



使用场景写扩展更适用于粉丝&#x2F;好友低于某个阈值的场景，比如刘亦菲子微博有将近7000万粉丝，如果采用写扩散的方式来做，那么每当她发布一条微博就会产生将近7000万条队列消息，试想一下如果有100个相同体量的微博博主，每天每个人发布一条微博就会产生7亿条队列消息，对消息系统的压力是巨大的。
同样的，读扩散则更适用于粉丝&#x2F;好友高于某个阈值的场景。
在一个庞大的类微博 feed 流系统中更合适的场景应该是基于某个阈值，同时使用读扩散和写扩散来实现内容的发布和拉取。
缓存feed list 缓存可以使用 redis 的 zset 结构存储
1zadd user_id 1618035919 creator_id:feed_id</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/95efbe0f/" title="「牧羊少年奇幻之旅」读书笔记"><img class="post_bg" src="https://graph.linganmin.cn/210228/cef6fc9fa9893597c907e7a03410ccb5?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="「牧羊少年奇幻之旅」读书笔记"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/95efbe0f/" title="「牧羊少年奇幻之旅」读书笔记">「牧羊少年奇幻之旅」读书笔记</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-03-02T14:03:51.000Z" title="发表于 2021-03-02 22:03:51">2021-03-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a></span></div><div class="content">
读书是一遍遍的走向未来，又一遍遍的回到过去。– @吴伯凡

第一次接触这本书是源于听喜马拉雅的一档电台节目，《东吴同学会》第二季的最后一期节目的最后，吴伯凡老师简单讲了这个少年的故事，推荐了这本书。吴老师说你不受梦想的蛊惑、不向未来出发，你是不知道自己起点的价值，
这本是关于信仰和天命的书，讲的是一个从小就不甘于平凡、向往外面的世界的少年在梦境的指引下，放下了自己熟悉的大草原和羊群踏上寻找宝藏以及寻找宝藏经历生死一路成长的故事。读这本书，每个人可能都能Get到自己深思的点。
在如今浮躁的大环境里，我们都在为生活&#x2F;生存耗费了大部分的精力，连安静的坐下来读会书都很难（ps:我说我自己）。但在读这个故事的时候会发现自己这一路成长着实和牧羊少年有些相像，牧羊少年在寻找宝藏的过程中找到了自己内心心爱的女人，学会了很多东西，对人世间的事有了很好的观察与了解。自己何尝不是如此，当你认识越多的人、见到更多的物、读过更多的书、走过多一些的路，你会发现自己的心气是有变化的，你不会固执的以为自己所有的观点都是对的，你慢慢会学着倾听他人表达的想法，也会学着换个角度思考问题。也许就是罗翔老师说的那句 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/d19db3c7/" title="（手机/相机）摄影方法论"><img class="post_bg" src="https://graph.linganmin.cn/210129/ff3ec3dfff84ce639b936d487e8dba6f?x-oss-process=image/format,webp/quality,q_100" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="（手机/相机）摄影方法论"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/d19db3c7/" title="（手机/相机）摄影方法论">（手机/相机）摄影方法论</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-01-29T14:03:00.000Z" title="发表于 2021-01-29 22:03:00">2021-01-29</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a></span></div><div class="content">好的照片
明确的主题
主体突出
画面简洁

光的应用
侧光
有立体感


逆光
剪影



黄金时间
日出后两小时内
日落前两小时内

室内
靠近窗户或打开室内灯（台灯）

手机闪光灯
1-1.5 米内使用
背景要有一些亮度，不然只有主体很亮，没有层次感。
手电筒做光源

构图
点构图
中心点构图
画面主体放在中心点


三分点构图
画面主体放在三分点




线构图
对称线构图
沿画面的水平或者垂直中线构图


三分线构图
画面的水平或垂直元素安排在三分线上。
注意：水平三分线构图要留意强调的部分，垂直三分线构图拍摄任务注意人物的朝向


对角线构图
利用照片对角线进行构图，有延展感，视觉冲击
注意事项：建议把画面主体聚焦在三分点上


曲线构图
利用自然存在的曲线或者认为只在的曲线进行构图


引导线构图
利用画面中的线条，把观众的目光吸引到画面主体上
注意事项：引导的主体建议处于画面中心点或者三分点


黄金分割构图
新手不建议使用，掌握好三分线构图就好




面构图
前景构图
在画面中加入前景
注意事项：前景和画面主题要有一定联系


框架构图
把例如门、窗等框架作为一种前景 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/31cade2d/" title="分布式架构中的”一致性“"><img class="post_bg" src="https://graph.linganmin.cn/201007/87122d3084205a5821b1e39413e84349?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式架构中的”一致性“"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/31cade2d/" title="分布式架构中的”一致性“">分布式架构中的”一致性“</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-01-06T23:30:20.000Z" title="发表于 2021-01-07 07:30:20">2021-01-07</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%A5%BD%E5%A5%BD%E5%AD%A6%E4%B9%A0/">好好学习</a></span></div><div class="content">一致性什么是 CAP
Consistent
一致性
同样的数据在分布式系统中所有地方都是被复制成相同的。




Available
可用性
所有在分布式系统活跃的节点都能处理操作且响应查询。




Partition Tolerant
分区容错性
在两个复制系统之间，如果发生了计划之外的网络连接问题，有一套容错性设计来保证。






CAP 是分布式系统中进行平衡的理论。一般情况下，CAP 理论任务你不能同时拥有上述三种，只能同时选择两种。

数据一致性
复制是导致出现数据一致性问题的唯一原因

强一致性（线性一致性）和弱一致性
强一致性
系统中的某个数据被成功更新后，后续任何对于该数据的读操作都将得到更新后的值。简而言之就是，在任意时刻，所有节点的数据是一样的。
写时复制，复制是同步的。主库需要等待从库的确认，确认从库已经收到写入操作。
缺点是，保证了强一致性，必然会损耗可用性。




弱一致性
复制是异步的。不需要等待从库响应。



半同步概念使一个从库保证和主库是强一致性，其他从库保持弱一致性。如果强一致性从库出现问题，则使另一个从库和主库保持强一致性。这样可以确保永 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/1a41abc9/" title="「深入学习 Golang」之 切片（slice）、数组（array）"><img class="post_bg" src="https://graph.linganmin.cn/201007/87122d3084205a5821b1e39413e84349?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="「深入学习 Golang」之 切片（slice）、数组（array）"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/1a41abc9/" title="「深入学习 Golang」之 切片（slice）、数组（array）">「深入学习 Golang」之 切片（slice）、数组（array）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-10-06T21:30:20.000Z" title="发表于 2020-10-07 05:30:20">2020-10-07</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%A5%BD%E5%A5%BD%E5%AD%A6%E4%B9%A0/">好好学习</a></span></div><div class="content">数组
数组是由相同类型元素组合成的数据结构，计算机会为数组分配一块连续的内存来保存其中的元素。我们可以利用数组中元素的索引，快速访问元素对应的存储地址。


Go 语言中数组在初始化之后大小是无法改变的。
存储元素类型相同，但大小不同的数组在 GO 语言中是完全不同的



创建123arr1 := [3]uint64&#123;1,2,3&#125; // 显示指定数组大小arr2 := [...]uint64&#123;1,2,3&#125; // 在编译期间通过源码对数组大小进行推导

如果数组中元素个数小于或等于4个，那么所有的变量都会直接在栈上初始化；如果数组元素大于4个，变量就会在静态存储区初始化然后拷贝到栈上。
访问和赋值数组在内存中就是一连串的内存空间，表示数组的方法是一个指向数组开头的指针、数组中元素的数量以及数组中元素类型站的空间大小。
如果我们不知道数组中元素的数量，访问时就可能发生越界，数组访问越界是非常严重的错误。
对数组的访问和复制需要同时依赖编译器和运行时，它的大多数操作在编译期间都会转换成对内存的直接读写，在中间代码生产期间还会插入运行时方法panicI ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/943537f7/" title="「深入学习 Golang」之 GPM"><img class="post_bg" src="https://graph.linganmin.cn/201007/87122d3084205a5821b1e39413e84349?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="「深入学习 Golang」之 GPM"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/943537f7/" title="「深入学习 Golang」之 GPM">「深入学习 Golang」之 GPM</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-10-03T07:40:34.000Z" title="发表于 2020-10-03 15:40:34">2020-10-03</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%A5%BD%E5%A5%BD%E5%AD%A6%E4%B9%A0/">好好学习</a></span></div><div class="content">相关术语runtimeruntime在 Golang 程序中很重要，runtime包含了调度、内存、垃圾回收、内部数据结构、定时器和各种系统调用的封装等。
schedulerscheduler是指调度器，主要工作是将准备好运行的Goroutine分散到工作线程中执行。
TLS(thread local storage)TLS代表每个线程中的本地数据，每个线程写入 TLS 的数据相互独立互不影响，Golang 的协程非常依赖 TLS 机制。TLS 里会存储当前线程中的Goroutine和其所属的Machine实例。
spiningspining表示重复某块代码。
systemstack、mcall 或 asmcgocallTODO 这个没看懂。。。。。。
调度模型（GPM）线程模型Golang 中的goroutine和go scheduler的底层实现都是属于两级线程模型



KSE是操作系统本身内核态的线程的简称（Kernel Scheduler Entities）。

我们现在的计算机语言，可以狭义的认为是一种“软件”，它们中所谓的“线程”，往往是用户态的线程，用户态线程和操作系统 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/311f4be0/" title="2020.10.01 去「大陈岛」看海了"><img class="post_bg" src="https://graph.linganmin.cn/201004/3190e5ac9987d0ad0c09eeae9ffe680b?x-oss-process=image/format,webp/quality,q_3" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2020.10.01 去「大陈岛」看海了"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/311f4be0/" title="2020.10.01 去「大陈岛」看海了">2020.10.01 去「大陈岛」看海了</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-09-20T07:06:34.000Z" title="发表于 2020-09-20 15:06:34">2020-09-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%97%85%E8%A1%8C/">旅行</a></span></div><div class="content">大陈岛分上大陈和下大陈，下大陈开发相对完善，一般住宿都会在下大陈，下大陈比较值得去的应该就是甲午岩景区，沿着峭壁一路走到到尽头是观景台，可以面朝大海，如果晴天可以在观景台看日出。上大陈新开发了乌沙头风景区（目前是免费开放，但需要提前预约，在公众号大美大陈，我去的时候人比较少所以没要查票，当然我也没预约上），这里有乌沙滩、观景台、泡洞、滨海(绝壁)栈道，值得一去。
有一点需要注意的是，整个大陈岛的地图在各大地图软件上均不完善，很多路和景点在地图上都查不到，或者查到的是不对的。上大陈尤为明显，我骑小电驴饶了好久好久。惨~~~
行程
提前 15 天，12306 订上海 -&gt; 台州高铁
提前 3 天，公众号大美大陈买椒江 -&gt; 下大陈岛船票
有快船和慢船，建议慢船
建议提前备好晕船药或晕船贴


09.30 07:00 虹桥枢纽 4 路到高铁站乘车出发前往台州
11:20 到台州站，打车前往椒江七号码头
12:30 登船，驶向深蓝（东海方向）
因为海上风浪很大，所以船上是不能上甲板的，这一点和舟山群岛不太一样，舟山那边属于近海一般慢船是可以上甲板的


14:10 到达下大陈岛

 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/3810a6eb/" title="「深入学习 Golang」之 Goroutine"><img class="post_bg" src="https://graph.linganmin.cn/201007/87122d3084205a5821b1e39413e84349?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="「深入学习 Golang」之 Goroutine"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/3810a6eb/" title="「深入学习 Golang」之 Goroutine">「深入学习 Golang」之 Goroutine</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-09-14T22:40:34.000Z" title="发表于 2020-09-15 06:40:34">2020-09-15</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%A5%BD%E5%A5%BD%E5%AD%A6%E4%B9%A0/">好好学习</a></span></div><div class="content">进程、线程、协程进程
进程是系统资源分配的最小单位
进程包括text region，data region和stack region等
进程的创建和销毁都是系统资源级别的，因此是一种比较昂贵的操作
进程是抢占式调度，他有三个状态：等待态、就绪态、运行态
进程之间是相互隔离的，每个进程有各自的系统资源，更加安全同时也带来了进程间通信不便的问题
进程是线程的载体

线程
同一个进程的多个线程共享进程的资源
每个线程也拥有自己的一少部分独立的资源
线程相比进程更加轻量，同一个进程内的多个线程通信比多个进程间通信容易，同时也带来了同步、互斥和线程安全的问题

协程
协程调度不需要内核参与，是完全由用户态程序决定的
协程不是抢占式调度，多个协程进行协作调度，避免了系统切换开销导致 CPU 使用率高

goroutine协程并不是 Go 语言的特有机制，Go 语言是在原生语言层面支持的的协程。Go 语言可以通过通信实现 goroutine 之间的数据共享。

Golang 中，不要通过共享内存来通信，而应该通过通信来共享内存！


创建一个 goroutine 不需要太多的内存，大概 2KB 左右 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/f902dddb/" title="「Kubernetes 拾遗」之 输入 kubectl run/create/apply 之后到底发生了什么"><img class="post_bg" src="https://graph.linganmin.cn/200911/4043741d339ab2812a46836518975aa7?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="「Kubernetes 拾遗」之 输入 kubectl run/create/apply 之后到底发生了什么"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/f902dddb/" title="「Kubernetes 拾遗」之 输入 kubectl run/create/apply 之后到底发生了什么">「Kubernetes 拾遗」之 输入 kubectl run/create/apply 之后到底发生了什么</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-09-11T14:40:34.000Z" title="发表于 2020-09-11 22:40:34">2020-09-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="content">周四的时候参加我司容器组大佬的课，问到一个问题：

kubectl run nginx --image=nginx --replicals=3 当这行命令在终端敲下回车键之后你会看到很快有三个nginx pod创建在集群的worker节点上，但当敲下回车键的时候kubernetes背后都做了什么呢？

自认为对 k8s 还算熟悉的在下一下子懵了，好像知道但又说不清楚。那今天就系统性的查资料+实践总结一下吧。

kubectl客户端验证执行客户端验证，确保非法请求（创建的资源不存在、镜像格式不正确等）的快速失败，减少对kuber-apiserver的不必要请求提升系统性能。
生成运行时对象使用generator根据需要创建资源类型来构建运行时对象(runtime object)

如果显示的设置了--generator参数，kubectl 将使用指定的生成器。如果没有指定生成器，kubectl 会根据其他参数自动选择要使用的生成器。具体优先级如下：

1234--schedule=&lt;schedule&gt;  CronJob--restart=Always       Deploy ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/8983aea6/" title="「Kubernetes 拾遗」之 Probe（探针）"><img class="post_bg" src="https://graph.linganmin.cn/200823/cedb311450bb165121fd1f1a6d49fa13?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="「Kubernetes 拾遗」之 Probe（探针）"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/8983aea6/" title="「Kubernetes 拾遗」之 Probe（探针）">「Kubernetes 拾遗」之 Probe（探针）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2020-08-10T14:40:34.000Z" title="发表于 2020-08-10 22:40:34">2020-08-10</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="content">Kubernetes 中的健康检查是使用存活性探针和就绪性探针来实现的，基于这两种探测机制，实现了 k8s 的自愈能力。可以做到：

异常节点(pod)自动剔除，并重建
安全的滚动升级策略

存活性探针livenessProbe用于判断当前容器是否存活(running)状态，如果livenessProbe探测到容器不健康，则kubectl会杀掉该容器，并根据容器的重启策略做相应重启操作。

如果一个容器不包含livenessProbe，那么kubectl会始终认为该容器的存活性探针返回的永远是success状态。

就绪性探针readinessProbe用于判断当前容器是否完成启动(read状态)，如果readinessProbe探测到容器不健康，则判定该容器不可接收流量，Endpoint Controller将从该服务对应的Service的endpoints中移除该容器的endpoint。
探测方式
HTTP
TCP
Exec 命令

实际在生产环境使用livenessProbe12345678910livenessProbe:    httpGet:      path: /pin ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/2/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/#content-inner">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/#content-inner">4</a><a class="page-number" href="/page/5/#content-inner">5</a><a class="extend next" rel="next" href="/page/4/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://graph.linganmin.cn/200118/06177d8b92c66f2c3a6fd82cca544f51" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">安小下同学</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/linganmin" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:saboranmin@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.weibo.com/u/1793963601" target="_blank" title="Weibo"><i class="fab fa-weibo"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">来日方短、道阻且长；好好吃饭，好好睡觉、保重身体、好好生活，农历癸卯年快乐 ^_^</div></div><div class="sticky_layout"><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Channel/" style="font-size: 1.1em; color: #999">Channel</a> <a href="/tags/Consul/" style="font-size: 1.1em; color: #999">Consul</a> <a href="/tags/Deployment/" style="font-size: 1.1em; color: #999">Deployment</a> <a href="/tags/Docker/" style="font-size: 1.34em; color: #99a3b0">Docker</a> <a href="/tags/DockerCompose/" style="font-size: 1.18em; color: #999ca1">DockerCompose</a> <a href="/tags/DokerCompose/" style="font-size: 1.1em; color: #999">DokerCompose</a> <a href="/tags/Feed%E6%B5%81/" style="font-size: 1.1em; color: #999">Feed流</a> <a href="/tags/Fluent/" style="font-size: 1.18em; color: #999ca1">Fluent</a> <a href="/tags/GC/" style="font-size: 1.1em; color: #999">GC</a> <a href="/tags/GMP/" style="font-size: 1.1em; color: #999">GMP</a> <a href="/tags/Gin%E6%A1%86%E6%9E%B6/" style="font-size: 1.1em; color: #999">Gin框架</a> <a href="/tags/Golang/" style="font-size: 1.42em; color: #99a6b7">Golang</a> <a href="/tags/Goroutine/" style="font-size: 1.1em; color: #999">Goroutine</a> <a href="/tags/Grafana/" style="font-size: 1.1em; color: #999">Grafana</a> <a href="/tags/Helm/" style="font-size: 1.1em; color: #999">Helm</a> <a href="/tags/IPVS/" style="font-size: 1.1em; color: #999">IPVS</a> <a href="/tags/Ingress/" style="font-size: 1.1em; color: #999">Ingress</a> <a href="/tags/K8S%E6%8E%A2%E9%92%88/" style="font-size: 1.1em; color: #999">K8S探针</a> <a href="/tags/Kafka/" style="font-size: 1.1em; color: #999">Kafka</a> <a href="/tags/Kubeadm/" style="font-size: 1.18em; color: #999ca1">Kubeadm</a> <a href="/tags/Kubernetes/" style="font-size: 1.5em; color: #99a9bf">Kubernetes</a> <a href="/tags/MacOS/" style="font-size: 1.1em; color: #999">MacOS</a> <a href="/tags/MySQL/" style="font-size: 1.1em; color: #999">MySQL</a> <a href="/tags/Opentracing/" style="font-size: 1.1em; color: #999">Opentracing</a> <a href="/tags/POD/" style="font-size: 1.1em; color: #999">POD</a> <a href="/tags/Prometheus/" style="font-size: 1.18em; color: #999ca1">Prometheus</a> <a href="/tags/Redis/" style="font-size: 1.1em; color: #999">Redis</a> <a href="/tags/Traefik/" style="font-size: 1.1em; color: #999">Traefik</a> <a href="/tags/%E4%B8%80%E5%B9%B4%E5%8F%88%E4%B8%80%E5%B9%B4/" style="font-size: 1.26em; color: #999fa8">一年又一年</a> <a href="/tags/%E4%B8%87%E5%8D%B7%E4%B9%A6/" style="font-size: 1.18em; color: #999ca1">万卷书</a> <a href="/tags/%E4%B8%8A%E6%B5%B7/" style="font-size: 1.18em; color: #999ca1">上海</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 1.26em; color: #999fa8">中间件</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 1.1em; color: #999">分布式</a> <a href="/tags/%E5%A4%A7%E9%99%88%E5%B2%9B/" style="font-size: 1.1em; color: #999">大陈岛</a> <a href="/tags/%E6%91%84%E5%BD%B1/" style="font-size: 1.1em; color: #999">摄影</a> <a href="/tags/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/" style="font-size: 1.26em; color: #999fa8">日志收集</a> <a href="/tags/%E6%9E%B8%E6%9D%9E%E5%B2%9B/" style="font-size: 1.1em; color: #999">枸杞岛</a> <a href="/tags/%E6%BA%90%E7%A0%81/" style="font-size: 1.1em; color: #999">源码</a> <a href="/tags/%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/" style="font-size: 1.1em; color: #999">滚动更新</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.1em; color: #999">网络</a></div></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">41</div></div><div class="webinfo-item"><div class="item-name">已运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2018-12-31T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">51.1k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2023-05-01T02:27:16.818Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div><div class="card-widget user-map" id="user-map"><div class="item-headline"><i class="fas fa-heartbeat"></i><span>访客地图</span></div><div class="item-content"><script type="text/javascript" id="clstr_globe" src="//clustrmaps.com/globe.js?d=a7gP3sFK2EWGUn4ldSm-DEYh1XLHHOKeuRBrF9Lf-g4"></script></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2023 By 安小下同学</div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/"><img style="height:10px" src="https://img.alicdn.com/imgextra/i3/O1CN012VJ8YA22JOP4XNnCr_!!6000000007099-2-tps-20-20.png">苏ICP备16006718号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/pluginsSrc/medium-zoom/dist/medium-zoom.min.js"></script><div class="js-pjax"><script>function subtitleType () {
  if (true) { 
    window.typed = new Typed("#subtitle", {
      strings: ["诗和远方代替不了一日三餐，你的信念终究需要一个栖身之所。","好的生活应该是平静的生活，生活的理想就是理想的生活。","写代码，不含糖🍬"],
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50
    })
  } else {
    document.getElementById("subtitle").innerHTML = '诗和远方代替不了一日三餐，你的信念终究需要一个栖身之所。'
  }
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('/pluginsSrc/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>