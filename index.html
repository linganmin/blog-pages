<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>小下同学 - 找不到北，就多看东西</title><meta name="author" content="安小下同学"><meta name="copyright" content="安小下同学"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="小下同学">
<meta property="og:url" content="https://blog.linganmin.cn/index.html">
<meta property="og:site_name" content="小下同学">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://graph.linganmin.cn/200118/06177d8b92c66f2c3a6fd82cca544f51">
<meta property="article:author" content="安小下同学">
<meta property="article:tag" content="安小下同学,闵令安,令安,小下,亲爱的安小下同学,小下同学,小小小下,前端,js,jquery,javascript,html5,开发者,程序猿,程序媛,极客,编程,代码,开源,IT网站,Developer,Programmer,Coder,Geek,html,css,css3,用户体验,php,laravel,golang,phper,docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://graph.linganmin.cn/200118/06177d8b92c66f2c3a6fd82cca544f51"><link rel="shortcut icon" href="https://graph.linganmin.cn/201206/fe9c5e8ef76354659ab9c6c8764d6f3d"><link rel="canonical" href="https://blog.linganmin.cn/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="KrvBZb2kkH"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/pluginsSrc/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b4e74da1cb3c8b4a65da55116b8cba6f";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.min.js',
      css: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '小下同学',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-07-24 09:22:53'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://graph.linganmin.cn/200118/06177d8b92c66f2c3a6fd82cca544f51" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://graph.linganmin.cn/200120/81525dc7a1a92645199b36b2e20cc2c8?x-oss-process=image/format,webp/quality,q_40')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">小下同学</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">小下同学</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/linganmin" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:saboranmin@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.weibo.com/u/1793963601" target="_blank" title="Weibo"><i class="fab fa-weibo"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/posts/57dfec22/" title="kube-prometheus-stack usage"><img class="post_bg" src="https://graph.linganmin.cn/230501/b1800426df2eeba8c39b3e1afcb43802?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="kube-prometheus-stack usage"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/57dfec22/" title="kube-prometheus-stack usage">kube-prometheus-stack usage</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-04-30T03:37:02.800Z" title="发表于 2023-04-30 11:37:02">2023-04-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="content">Environment
Kubernetes 集群
需要一个已经部署完成且可用的Kubernetes 1.16+集群。


Helm
helm version v3+



Steps
添加 helm 仓库
12helm repo add prometheus-community https://prometheus-community.github.io/helm-chartshelm repo update

将仓库拉取到本地
1helm pull prometheus-community/kube-prometheus-stack

将拉取到的压缩包解压
12345678910tar -zxvf kube-prometheus-stack-45.8.1.tgz # kube-prometheus-stack/Chart.yaml# kube-prometheus-stack/Chart.lock# kube-prometheus-stack/values.yaml# kube-prometheus-stack/templates/NOTES.txt# kube-prometheu ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/52d6062e/" title="浅析 IPVS"><img class="post_bg" src="https://graph.linganmin.cn/230210/8a82cd11d4e6a02325560651cc836f57?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="浅析 IPVS"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/52d6062e/" title="浅析 IPVS">浅析 IPVS</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-02-10T07:49:00.930Z" title="发表于 2023-02-10 15:49:00">2023-02-10</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="content">TODOTODOTODOTODO
</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/49a0b438/" title="Linux OS 的 Init 和 Systemd"><img class="post_bg" src="https://graph.linganmin.cn/230202/45c4be216e488ead47b3373c4a04187f?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux OS 的 Init 和 Systemd"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/49a0b438/" title="Linux OS 的 Init 和 Systemd">Linux OS 的 Init 和 Systemd</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-02-02T06:55:37.169Z" title="发表于 2023-02-02 14:55:37">2023-02-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a></span></div><div class="content">什么是 Init 守护进程Init守护进程是Linux内核执行的第一个进程，它的进程ID（PID）始终是1，它的目的是初始化、管理和跟踪系统服务和守护进程，也就是说init deamon(Init 守护进程)是系统上所有进程的父进程。
什么是 InitInit（也被称为System V init或者SysVinit），它是一个初始化守护进程，创建于 1980 年。它定义了6个运行级别（系统状态）并将所有的系统服务映射到这些运行级别。这使得所有服务都会以预定义的顺序启动，只有当顺序中的当前脚本执行完成或者卡主超时时才会执行下一个脚本。除了执行超时导致无法预期的等待之外，串行的启动服务也会使得系统初始化过程效率低下且相对较慢。
什么是 SystemdSystemd(system daemon)是现代系统使用的init守护进程，它并行的启动系统服务，从而消除不必要的延迟并加快初始化进程。systemd通过使用Unit Dependencies来定义一个服务是否想要&#x2F;需要依赖其他服务才能运行，使用Unit Order来定义一个服务是否需要在它之前&#x2F;之后启动。可以使用syst ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/c62b22dc/" title="使用 Kubeadm 部署 Kubernetes 集群（基于 Containerd 运行时）"><img class="post_bg" src="https://graph.linganmin.cn/230201/236bd147e42b9a2fcd31784975f76399?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 Kubeadm 部署 Kubernetes 集群（基于 Containerd 运行时）"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/c62b22dc/" title="使用 Kubeadm 部署 Kubernetes 集群（基于 Containerd 运行时）">使用 Kubeadm 部署 Kubernetes 集群（基于 Containerd 运行时）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-02-01T06:32:12.228Z" title="发表于 2023-02-01 14:32:12">2023-02-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="content">基础知识CRI、Containerd、OCI、runcCRICRI(Container Runtime Interface)是Kubernetes定义的接口，定义了如何操作容器和镜像的统一规范。Kubernetes 尽量不关心您使用哪个容器运行时。 它只需要能够向它发送指令——为Pod创建容器、终止它们等等。 这就是CRI的用武之地。CRI 是对现在或将来可能存在的任何类型的容器运行时的抽象。 所以 CRI 让 Kubernetes 更容易使用不同的容器运行时。 CRI API描述了Kubernetes如何与任何运行时交互，而不是Kubernetes项目需要单独添加对每个运行时的支持。 只要给定的容器运行时实现了CRI API，运行时就可以随心所欲地创建和启动容器。

Containerdcontainerd是一个来自Docker的高级容器运行时，并实现了CRI规范。它是从Docker项目中分离出来，之后containerd被捐赠给云原生计算基金会（CNCF）为容器社区提供创建新容器解决方案的基础。
所以Docker自己在内部使用containerd，当你安装Docker时也会安装co ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/4f614365/" title="Kubernetes 集群部署之网段划分"><img class="post_bg" src="https://graph.linganmin.cn/230201/1121c70cca031f2591b48ce72261dedc?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kubernetes 集群部署之网段划分"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/4f614365/" title="Kubernetes 集群部署之网段划分">Kubernetes 集群部署之网段划分</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-02-01T03:53:34.324Z" title="发表于 2023-02-01 11:53:34">2023-02-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="content">Kubernetes 集群部署会涉及到如下三个网段

宿主机网段
准备安装 Kubernetes 集群的服务器的内网网段


POD 网段
Kubernetes 中部署的 POD 的网段


Service 网段
Kubernetes 中部署的 Service 的网段



需要注意的的是在部署Kubernetes的时候，这三个网段之间不能有任何的交叉。比如，如果宿主机的网段是172.16.168.135/12，那么Service或Pod的网段就不能在172.16.0.1~172.31.255.254之间。
所以一般的推荐是，三个网段的第一位就不要重复，比如宿主机的网段如果是172开头，那么Service和Pod就不要用172打头的网段，这样不近可以避免网段冲突，还可以减去计算的步骤。

A 类地址子网掩码最小为8B 类地址子网掩码最小为16C 类地址子网掩码最小为24
为了方便POD数量的扩展，应该给POD设置B类或A类地址，因为C类最多只有254个可用IP。
</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/e11179c6/" title="使用 Fluentd + ElasticSearch 搭建 docker stdout 日志解决方案"><img class="post_bg" src="https://graph.linganmin.cn/220918/09a22a20c3b33f091ac17d50dba2e259?x-oss-process=image/format,webp/quality,q_60" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 Fluentd + ElasticSearch 搭建 docker stdout 日志解决方案"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/e11179c6/" title="使用 Fluentd + ElasticSearch 搭建 docker stdout 日志解决方案">使用 Fluentd + ElasticSearch 搭建 docker stdout 日志解决方案</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-12-08T14:40:34.000Z" title="发表于 2022-12-08 22:40:34">2022-12-08</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="content">整体架构如下图，容器产生的 stdout 日志通过 Fluentd 分发到 ElasticSearch 的不同索引，然后通过 Kibana 进行可视化查询、搜索等。

部署ElasticSearch &amp; Kibana笔者使用的是docker-compose方式部署的 ES 集群和 Kibana，参考文件如下：
目录结构12345&gt;ls -aldrwxr-xr-x 2 root root 4096 9月  18 14:45 .drwxr-xr-x 7 root root 4096 9月  15 14:50 ..-rw-r--r-- 1 root root 7956 9月  16 14:18 docker-compose.yaml-rw-r--r-- 1 root root  776 9月  16 13:43 .env

.env 配置文件内容123456789101112131415161718192021222324252627282930# 此处为 elastic 用户设置密码，至少6个字符ELASTIC_PASSWORD=# 此处设置kibana密码KIBANA_PA ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/9a11c27c/" title="使用 Docker Compose 实现滚动更新部署"><img class="post_bg" src="https://graph.linganmin.cn/221209/61c7c60a1231bd6f951d4db4f6330460?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 Docker Compose 实现滚动更新部署"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/9a11c27c/" title="使用 Docker Compose 实现滚动更新部署">使用 Docker Compose 实现滚动更新部署</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-09-09T14:40:34.000Z" title="发表于 2022-09-09 22:40:34">2022-09-09</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="content">最近在写一个Golang的微服务项目，受限于测试和生产环境交付的时候都无法使用到Kubernetes，所以准备使用Docker Compose部署，记录一下实现方式。
思路
变更容器编排文件docker-compose.yaml
获取当前启动的容器id，标识为旧容器
更新并调度服务比当前容器数量多的指定数量
杀掉标识的旧容器
清理杀掉的旧容器
重新调度服务容器数量为期望数量

shell 脚本实现
备注：此脚本需在 docker-compose.yaml 编排文件所在目录执行。或者自己改脚本，cd 进目标目录执行

12345678910111213141516171819202122# 1. 更新 docker-compose.yaml，有很多选择，你可以手动更新，也可以使用 ci 自动使用新的编排文件覆盖。总之就是把当前目录下的编排文件变成你期望的最新的，有可能是只改了镜像，或者其他# 取到使用当前目录下的编排文件启动的服务容器idprevious_container=`docker-compose ps -q`# 将容器数量调度到指定值，此值需要大于当前服务的容器数量docker ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/c1dd7ead/" title="使用 log-pilot + elk 搭建 docker stdout 日志解决方案"><img class="post_bg" src="https://graph.linganmin.cn/211107/bf81612871634692c7c423dcc5aef292?x-oss-process=image/format,webp/quality,q_60" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 log-pilot + elk 搭建 docker stdout 日志解决方案"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/c1dd7ead/" title="使用 log-pilot + elk 搭建 docker stdout 日志解决方案">使用 log-pilot + elk 搭建 docker stdout 日志解决方案</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-08-08T14:40:34.000Z" title="发表于 2022-08-08 22:40:34">2022-08-08</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="content">最近在写一个Golang的微服务项目，受限于企业内部网络等各种问题，日志无法上云只好自建日志收集管理平台了，记录一下实现方式。

整个环境从服务到elk到log-pilot均使用docker-compose部署

log-pilot 介绍log-Pilot 是一个阿里云开源的一款智能容器日志采集工具，它不仅能够高效便捷地将容器日志采集输出到多种存储日志后端，同时还能够动态地发现和采集容器内部的日志文件。log-pilot 通过声明式配置实现强大的容器事件管理，可同时获取容器标准输出和内部文件日志，解决了动态伸缩问题，此外，log-pilot 具有自动发现机制，CheckPoint 及句柄保持的机制，自动日志数据打标，有效应对动态配置、日志重复和丢失以及日志源标记等问题。
log-Pilot代码仓库
log-pilot 特性
一个单独的 log 进程收集机器上所有容器的日志。不需要为每个容器启动一个 log 进程。
支持文件日志和 stdout
docker log dirver 亦或 logspout 只能处理 stdout，log-pilot 不仅支持收集 stdout 日志，还可以 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/4679c257/" title="搭建基于 Kubernetes 生产可用的日志和监控系统"><img class="post_bg" src="https://graph.linganmin.cn/220529/b208e0a803bbec39eab9007b774f2d92?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="搭建基于 Kubernetes 生产可用的日志和监控系统"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/4679c257/" title="搭建基于 Kubernetes 生产可用的日志和监控系统">搭建基于 Kubernetes 生产可用的日志和监控系统</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-05-29T14:40:34.000Z" title="发表于 2022-05-29 22:40:34">2022-05-29</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="content">前言本篇文章涉及很多 Kubernetes 基础知识，包括但不限于以下资源对象：

Namespace
Pod
Deployment
Service
Headless Service


Volume
PersistenVolume
PersistenVolumeClaim




StatefulSet
DaemonSet
Ingress
Role
ClusterRole



如果这些东西你还很陌生，请转战Kubernetes中文官方文档
基础设施安装工具1yum install bind-utils -y

内网免密登录1ssh-keygen

master 节点的 pub key 加入各节点的 auth key

初始化集群为了节省时间使用了 sealos 工具来搭建 K8S 集群，如果你想了解使用 Kubeadm 部署 K8S 集群可以参考笔者的另一篇文章Kubeadm 安装 Kubernetes V1.22.2 踩坑手记
工具12wget -c https://sealyun-home.oss-cn-beijing.aliyuncs.com/sealos/latest/se ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/3825abf1/" title="浅析 Golang 内存机制（内存分配、GC、内存逃逸）"><img class="post_bg" src="https://graph.linganmin.cn/220308/d4ae2041db5705ff090a064e92e12d78?x-oss-process=image/format,webp/quality,q_60" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="浅析 Golang 内存机制（内存分配、GC、内存逃逸）"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/3825abf1/" title="浅析 Golang 内存机制（内存分配、GC、内存逃逸）">浅析 Golang 内存机制（内存分配、GC、内存逃逸）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-03-08T14:30:20.000Z" title="发表于 2022-03-08 22:30:20">2022-03-08</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E5%A5%BD%E5%A5%BD%E5%AD%A6%E4%B9%A0/">好好学习</a></span></div><div class="content">内存分配
Go 程序在启动时，会向操作系统申请一定区域的内存，分为堆（Heap）和栈（Stack）。


堆（Heap）
一般来讲是人为手动进行管理，手动申请、分配和释放。所涉及的内存大小并不定，一版会存放比较大的对象。分配相对较慢涉及到的指令动作相对较多。
在 Go 语言中，堆内存由程序申请分配，由 GC（Garbage Collection）负责回收


栈（Stack）
由编译器进行管理，自动申请、分配、释放。一般不会太大，我们常见的函数参数、局部变量等等都会放在栈上。
在 Go 语言中，栈内存会随着函数的调用而进行分配，随着函数的调用结束而回收




性能上，栈内存的使用和回收会更快一些，尽管 Golang 的 GC 很高效，但过程中还会在标记准备阶段和标记结束阶段进行 STW，因此，会优先使用栈内存进行分配（因为栈内存更高效，不需要 GC，所以会尽可能将内存分配到栈上），在某些特殊场景下可能会发生内存逃逸到堆上

GC（Garbage Collection）标记清除法在 Go 1.3 之前的版本使用的是标记清除法（mark and sweep），大致流程如下：

暂停程序业 ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/#content-inner">5</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://graph.linganmin.cn/200118/06177d8b92c66f2c3a6fd82cca544f51" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">安小下同学</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/linganmin" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:saboranmin@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.weibo.com/u/1793963601" target="_blank" title="Weibo"><i class="fab fa-weibo"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">来日方短、道阻且长；好好吃饭，好好睡觉、保重身体、好好生活，农历癸卯年快乐 ^_^</div></div><div class="sticky_layout"><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Channel/" style="font-size: 1.1em; color: #999">Channel</a> <a href="/tags/Consul/" style="font-size: 1.1em; color: #999">Consul</a> <a href="/tags/Deployment/" style="font-size: 1.1em; color: #999">Deployment</a> <a href="/tags/Docker/" style="font-size: 1.34em; color: #99a3b0">Docker</a> <a href="/tags/DockerCompose/" style="font-size: 1.18em; color: #999ca1">DockerCompose</a> <a href="/tags/DokerCompose/" style="font-size: 1.1em; color: #999">DokerCompose</a> <a href="/tags/Feed%E6%B5%81/" style="font-size: 1.1em; color: #999">Feed流</a> <a href="/tags/Fluent/" style="font-size: 1.18em; color: #999ca1">Fluent</a> <a href="/tags/GC/" style="font-size: 1.1em; color: #999">GC</a> <a href="/tags/GMP/" style="font-size: 1.1em; color: #999">GMP</a> <a href="/tags/Gin%E6%A1%86%E6%9E%B6/" style="font-size: 1.1em; color: #999">Gin框架</a> <a href="/tags/Golang/" style="font-size: 1.42em; color: #99a6b7">Golang</a> <a href="/tags/Goroutine/" style="font-size: 1.1em; color: #999">Goroutine</a> <a href="/tags/Grafana/" style="font-size: 1.1em; color: #999">Grafana</a> <a href="/tags/Helm/" style="font-size: 1.1em; color: #999">Helm</a> <a href="/tags/IPVS/" style="font-size: 1.1em; color: #999">IPVS</a> <a href="/tags/Ingress/" style="font-size: 1.1em; color: #999">Ingress</a> <a href="/tags/K8S%E6%8E%A2%E9%92%88/" style="font-size: 1.1em; color: #999">K8S探针</a> <a href="/tags/Kafka/" style="font-size: 1.1em; color: #999">Kafka</a> <a href="/tags/Kubeadm/" style="font-size: 1.18em; color: #999ca1">Kubeadm</a> <a href="/tags/Kubernetes/" style="font-size: 1.5em; color: #99a9bf">Kubernetes</a> <a href="/tags/MacOS/" style="font-size: 1.1em; color: #999">MacOS</a> <a href="/tags/MySQL/" style="font-size: 1.1em; color: #999">MySQL</a> <a href="/tags/Opentracing/" style="font-size: 1.1em; color: #999">Opentracing</a> <a href="/tags/POD/" style="font-size: 1.1em; color: #999">POD</a> <a href="/tags/Prometheus/" style="font-size: 1.18em; color: #999ca1">Prometheus</a> <a href="/tags/Redis/" style="font-size: 1.1em; color: #999">Redis</a> <a href="/tags/Traefik/" style="font-size: 1.1em; color: #999">Traefik</a> <a href="/tags/%E4%B8%80%E5%B9%B4%E5%8F%88%E4%B8%80%E5%B9%B4/" style="font-size: 1.26em; color: #999fa8">一年又一年</a> <a href="/tags/%E4%B8%87%E5%8D%B7%E4%B9%A6/" style="font-size: 1.18em; color: #999ca1">万卷书</a> <a href="/tags/%E4%B8%8A%E6%B5%B7/" style="font-size: 1.18em; color: #999ca1">上海</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 1.26em; color: #999fa8">中间件</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 1.1em; color: #999">分布式</a> <a href="/tags/%E5%A4%A7%E9%99%88%E5%B2%9B/" style="font-size: 1.1em; color: #999">大陈岛</a> <a href="/tags/%E6%91%84%E5%BD%B1/" style="font-size: 1.1em; color: #999">摄影</a> <a href="/tags/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/" style="font-size: 1.26em; color: #999fa8">日志收集</a> <a href="/tags/%E6%9E%B8%E6%9D%9E%E5%B2%9B/" style="font-size: 1.1em; color: #999">枸杞岛</a> <a href="/tags/%E6%BA%90%E7%A0%81/" style="font-size: 1.1em; color: #999">源码</a> <a href="/tags/%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/" style="font-size: 1.1em; color: #999">滚动更新</a> <a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.1em; color: #999">网络</a></div></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">41</div></div><div class="webinfo-item"><div class="item-name">已运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2018-12-31T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">51.2k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2023-07-24T01:22:53.014Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div><div class="card-widget user-map" id="user-map"><div class="item-headline"><i class="fas fa-heartbeat"></i><span>访客地图</span></div><div class="item-content"><script type="text/javascript" id="clstr_globe" src="//clustrmaps.com/globe.js?d=a7gP3sFK2EWGUn4ldSm-DEYh1XLHHOKeuRBrF9Lf-g4"></script></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2023 By 安小下同学</div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/"><img style="height:10px" src="https://img.alicdn.com/imgextra/i3/O1CN012VJ8YA22JOP4XNnCr_!!6000000007099-2-tps-20-20.png">苏ICP备16006718号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/pluginsSrc/medium-zoom/dist/medium-zoom.min.js"></script><div class="js-pjax"><script>function subtitleType () {
  if (true) { 
    window.typed = new Typed("#subtitle", {
      strings: ["诗和远方代替不了一日三餐，你的信念终究需要一个栖身之所。","好的生活应该是平静的生活，生活的理想就是理想的生活。","写代码，不含糖🍬"],
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50
    })
  } else {
    document.getElementById("subtitle").innerHTML = '诗和远方代替不了一日三餐，你的信念终究需要一个栖身之所。'
  }
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('/pluginsSrc/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>