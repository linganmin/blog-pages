<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>小下同学 - 找不到北，就多看东西</title><meta name="author" content="安小下同学"><meta name="copyright" content="安小下同学"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="小下同学">
<meta property="og:url" content="https://blog.linganmin.cn/index.html">
<meta property="og:site_name" content="小下同学">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://graph.linganmin.cn/200118/06177d8b92c66f2c3a6fd82cca544f51">
<meta property="article:author" content="安小下同学">
<meta property="article:tag" content="安小下同学,闵令安,令安,小下,亲爱的安小下同学,小下同学,小小小下,前端,js,jquery,javascript,html5,开发者,程序猿,程序媛,极客,编程,代码,开源,IT网站,Developer,Programmer,Coder,Geek,html,css,css3,用户体验,php,laravel,golang,phper,docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://graph.linganmin.cn/200118/06177d8b92c66f2c3a6fd82cca544f51"><link rel="shortcut icon" href="https://graph.linganmin.cn/201206/fe9c5e8ef76354659ab9c6c8764d6f3d"><link rel="canonical" href="https://blog.linganmin.cn/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="KrvBZb2kkH"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/pluginsSrc/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b4e74da1cb3c8b4a65da55116b8cba6f";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.min.js',
      css: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '小下同学',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2022-12-09 20:36:52'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://graph.linganmin.cn/200118/06177d8b92c66f2c3a6fd82cca544f51" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">40</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://graph.linganmin.cn/200120/81525dc7a1a92645199b36b2e20cc2c8?x-oss-process=image/format,webp/quality,q_40')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">小下同学</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">小下同学</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/linganmin" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:saboranmin@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.weibo.com/u/1793963601" target="_blank" title="Weibo"><i class="fab fa-weibo"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2022/12/08/docker/log-fluentd/" title="使用 Fluentd + ElasticSearch 搭建 docker stdout 日志解决方案"><img class="post_bg" src="https://graph.linganmin.cn/220918/09a22a20c3b33f091ac17d50dba2e259?x-oss-process=image/format,webp/quality,q_60" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 Fluentd + ElasticSearch 搭建 docker stdout 日志解决方案"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/12/08/docker/log-fluentd/" title="使用 Fluentd + ElasticSearch 搭建 docker stdout 日志解决方案">使用 Fluentd + ElasticSearch 搭建 docker stdout 日志解决方案</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-12-08T14:40:34.000Z" title="发表于 2022-12-08 22:40:34">2022-12-08</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Kubernetes/">Kubernetes</a></span></div><div class="content">整体架构如下图，容器产生的 stdout 日志通过 Fluentd 分发到 ElasticSearch 的不同索引，然后通过 Kibana 进行可视化查询、搜索等。

部署ElasticSearch &amp; Kibana笔者使用的是docker-compose方式部署的 ES 集群和 Kibana，参考文件如下：
目录结构12345&gt;ls -aldrwxr-xr-x 2 root root 4096 9月  18 14:45 .drwxr-xr-x 7 root root 4096 9月  15 14:50 ..-rw-r--r-- 1 root root 7956 9月  16 14:18 docker-compose.yaml-rw-r--r-- 1 root root  776 9月  16 13:43 .env

.env 配置文件内容123456789101112131415161718192021222324252627282930# 此处为 elastic 用户设置密码，至少6个字符ELASTIC_PASSWORD=# 此处设置kibana密码KIBANA_PA ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/09/09/docker/scrolling/" title="使用 Docker Compose 实现滚动更新部署"><img class="post_bg" src="https://graph.linganmin.cn/221209/61c7c60a1231bd6f951d4db4f6330460?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 Docker Compose 实现滚动更新部署"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/09/09/docker/scrolling/" title="使用 Docker Compose 实现滚动更新部署">使用 Docker Compose 实现滚动更新部署</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-09-09T14:40:34.000Z" title="发表于 2022-09-09 22:40:34">2022-09-09</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Kubernetes/">Kubernetes</a></span></div><div class="content">最近在写一个Golang的微服务项目，受限于测试和生产环境交付的时候都无法使用到Kubernetes，所以准备使用Docker Compose部署，记录一下实现方式。
思路
变更容器编排文件docker-compose.yaml
获取当前启动的容器id，标识为旧容器
更新并调度服务比当前容器数量多的指定数量
杀掉标识的旧容器
清理杀掉的旧容器
重新调度服务容器数量为期望数量

shell 脚本实现
备注：此脚本需在 docker-compose.yaml 编排文件所在目录执行。或者自己改脚本，cd 进目标目录执行

12345678910111213141516171819202122# 1. 更新 docker-compose.yaml，有很多选择，你可以手动更新，也可以使用 ci 自动使用新的编排文件覆盖。总之就是把当前目录下的编排文件变成你期望的最新的，有可能是只改了镜像，或者其他# 取到使用当前目录下的编排文件启动的服务容器idprevious_container=`docker-compose ps -q`# 将容器数量调度到指定值，此值需要大于当前服务的容器数量docker ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/08/08/docker/log-collect/" title="使用 log-pilot + elk 搭建 docker stdout 日志解决方案"><img class="post_bg" src="https://graph.linganmin.cn/211107/bf81612871634692c7c423dcc5aef292?x-oss-process=image/format,webp/quality,q_60" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 log-pilot + elk 搭建 docker stdout 日志解决方案"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/08/08/docker/log-collect/" title="使用 log-pilot + elk 搭建 docker stdout 日志解决方案">使用 log-pilot + elk 搭建 docker stdout 日志解决方案</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-08-08T14:40:34.000Z" title="发表于 2022-08-08 22:40:34">2022-08-08</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Kubernetes/">Kubernetes</a></span></div><div class="content">最近在写一个Golang的微服务项目，受限于企业内部网络等各种问题，日志无法上云只好自建日志收集管理平台了，记录一下实现方式。

整个环境从服务到elk到log-pilot均使用docker-compose部署

log-pilot 介绍log-Pilot 是一个阿里云开源的一款智能容器日志采集工具，它不仅能够高效便捷地将容器日志采集输出到多种存储日志后端，同时还能够动态地发现和采集容器内部的日志文件。log-pilot 通过声明式配置实现强大的容器事件管理，可同时获取容器标准输出和内部文件日志，解决了动态伸缩问题，此外，log-pilot 具有自动发现机制，CheckPoint 及句柄保持的机制，自动日志数据打标，有效应对动态配置、日志重复和丢失以及日志源标记等问题。
log-Pilot代码仓库
log-pilot 特性
一个单独的 log 进程收集机器上所有容器的日志。不需要为每个容器启动一个 log 进程。
支持文件日志和 stdout
docker log dirver 亦或 logspout 只能处理 stdout，log-pilot 不仅支持收集 stdout 日志，还可以 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/05/29/k8s/k8s-sys/" title="搭建基于 Kubernetes 生产可用的日志和监控系统"><img class="post_bg" src="https://graph.linganmin.cn/220529/b208e0a803bbec39eab9007b774f2d92?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="搭建基于 Kubernetes 生产可用的日志和监控系统"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/05/29/k8s/k8s-sys/" title="搭建基于 Kubernetes 生产可用的日志和监控系统">搭建基于 Kubernetes 生产可用的日志和监控系统</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-05-29T14:40:34.000Z" title="发表于 2022-05-29 22:40:34">2022-05-29</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Kubernetes/">Kubernetes</a></span></div><div class="content">前言本篇文章涉及很多 Kubernetes 基础知识，包括但不限于以下资源对象：

Namespace
Pod
Deployment
Service
Headless Service


Volume
PersistenVolume
PersistenVolumeClaim




StatefulSet
DaemonSet
Ingress
Role
ClusterRole



如果这些东西你还很陌生，请转战Kubernetes中文官方文档
基础设施安装工具1yum install bind-utils -y

内网免密登录1ssh-keygen

master 节点的 pub key 加入各节点的 auth key

初始化集群为了节省时间使用了 sealos 工具来搭建 K8S 集群，如果你想了解使用 Kubeadm 部署 K8S 集群可以参考笔者的另一篇文章Kubeadm 安装 Kubernetes V1.22.2 踩坑手记
工具12wget -c https://sealyun-home.oss-cn-beijing.aliyuncs.com/sealos/latest/se ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/03/08/golang/memory-gc-escape/" title="浅析 Golang 内存机制（内存分配、GC、内存逃逸）"><img class="post_bg" src="https://graph.linganmin.cn/220308/d4ae2041db5705ff090a064e92e12d78?x-oss-process=image/format,webp/quality,q_60" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="浅析 Golang 内存机制（内存分配、GC、内存逃逸）"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/03/08/golang/memory-gc-escape/" title="浅析 Golang 内存机制（内存分配、GC、内存逃逸）">浅析 Golang 内存机制（内存分配、GC、内存逃逸）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-03-08T14:30:20.000Z" title="发表于 2022-03-08 22:30:20">2022-03-08</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Golang/">Golang</a></span></div><div class="content">内存分配
Go 程序在启动时，会向操作系统申请一定区域的内存，分为堆（Heap）和栈（Stack）。


堆（Heap）
一般来讲是人为手动进行管理，手动申请、分配和释放。所涉及的内存大小并不定，一版会存放比较大的对象。分配相对较慢涉及到的指令动作相对较多。
在 Go 语言中，堆内存由程序申请分配，由 GC（Garbage Collection）负责回收


栈（Stack）
由编译器进行管理，自动申请、分配、释放。一般不会太大，我们常见的函数参数、局部变量等等都会放在栈上。
在 Go 语言中，栈内存会随着函数的调用而进行分配，随着函数的调用结束而回收




性能上，栈内存的使用和回收会更快一些，尽管 Golang 的 GC 很高效，但过程中还会在标记准备阶段和标记结束阶段进行 STW，因此，会优先使用栈内存进行分配（因为栈内存更高效，不需要 GC，所以会尽可能将内存分配到栈上），在某些特殊场景下可能会发生内存逃逸到堆上

GC（Garbage Collection）标记清除法在 Go 1.3 之前的版本使用的是标记清除法（mark and sweep），大致流程如下：

暂停程序业 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/03/06/golang/gin/" title="浅读 Go 优秀开源项目源码— Gin框架"><img class="post_bg" src="https://graph.linganmin.cn/220306/e6d48282ac21a3cc02dd7b6a2b571e81?x-oss-process=image/format,webp/quality,q_60" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="浅读 Go 优秀开源项目源码— Gin框架"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/03/06/golang/gin/" title="浅读 Go 优秀开源项目源码— Gin框架">浅读 Go 优秀开源项目源码— Gin框架</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-03-06T14:30:20.000Z" title="发表于 2022-03-06 22:30:20">2022-03-06</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Golang/">Golang</a></span></div><div class="content">
Gin 是一个用 Go (Golang) 编写的 HTTP web 框架。它是一个类似于 martini 但拥有更好性能的 API 框架, 由于 httprouter，速度提高了近 40 倍。

Gin 是目前 Go 里面使用最广泛的框架之一了，弄清楚 Gin 框架的原理，有助于我们更好的使用 Gin。通过浅读 Gin 框架源码，大致总结一下它的一些核心实现。
从一个 Demo 入手下面这段代码便是使用 Gin 编写一个简单的只有一个接口的 Go server 端程序，详细使用方式参考官方文档：Gin Web Frameword 
123456789101112131415161718192021222324252627package mainimport (    &quot;fmt&quot;    &quot;log&quot;    &quot;time&quot;    &quot;github.com/gin-gonic/gin&quot;)func main() &#123;    r := gin.Default()    // 注册路由    r.GET(&quot ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/02/19/others/consul/" title="基于 Consul 实现 gRPC 服务注册与发现"><img class="post_bg" src="https://graph.linganmin.cn/220219/f7972adc36f4c23da00f92f05b0b6be7?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于 Consul 实现 gRPC 服务注册与发现"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/02/19/others/consul/" title="基于 Consul 实现 gRPC 服务注册与发现">基于 Consul 实现 gRPC 服务注册与发现</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-02-18T19:30:20.000Z" title="发表于 2022-02-19 03:30:20">2022-02-19</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Middleware/">Middleware</a></span></div><div class="content">什么是服务注册与发现，为什么需要服务注册发现
服务注册
服务进程在注册中心注册自己的元数据，一般包括 Host 和 Port，有时候还有身份验证信息，协议，版本号以及运行环境等信息。


服务发现
客户端进程向服务注册中心发起查询，来获取依赖的服务的信息，然后向其发送请求。服务发现一个重要的作用是提供给客户端进程一个可用的服务列表。



简单的说，当服务A需要依赖服务B时，服务发现中间件需要告诉服务A哪些地址是服务B的可用地址，这就是服务注册发现需要解决的问题。

服务注册
客户端注册
服务自身负责注册与注销工作，当服务启动后注册线程向注册中心注册，当服务停止时注销自己。


代理注册
当服务启动后以某种方式通知代理服务，代理服务向注册中心发起注册工作。



健康检测
被动检测
服务主动向注册中心发送心跳消息，时间间隔可以自定义。注册中心如果在指定周期内未收到服务节点的心跳消息，则将其从该服务可用节点列表中移除


主动检测
服务注册中心指定时间间隔内向所有列表中的服务节点发送心跳检测，如果指定周期内未成功则主动移除该节点。



服务发现
客户端发现
客户端向注册中心发起请求查询 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2022/02/17/golang/opentracing-golang/" title="使用 Opentracing 实现 Golang 链路追踪"><img class="post_bg" src="https://graph.linganmin.cn/220217/66b241b8bb939fb3fbac1dc2956f3114?x-oss-process=image/format,webp/quality,q_60" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 Opentracing 实现 Golang 链路追踪"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/02/17/golang/opentracing-golang/" title="使用 Opentracing 实现 Golang 链路追踪">使用 Opentracing 实现 Golang 链路追踪</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-02-17T14:40:34.000Z" title="发表于 2022-02-17 22:40:34">2022-02-17</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Golang/">Golang</a></span></div><div class="content">为什么需要链路追踪在微服务架构系统中，请求在各服务之间流转，调用链路错综复杂，一旦出现了问题和异常，定位问题相当困难。链路追踪系统可以追踪并记录请求在系统中的调用顺序、调用时长等一系列关键信息，从而帮我们更简单的定位服务异常。
OpentracingOpentracing 是分布式链路追踪的一种规范标准，是 CNCF（云原生计算基金）孵化的项目之一。和一般规范标准不同，Opentracing 不是传输协议、也不是消息格式上的规范标准，而是一种语言层面上的 API 标准。只要在某链路追踪系统实现了 Opentracing 规定的接口，符合 Opentracing 定义的表现行为，那么就可以说该应用符合 Opentracing 标准。这意味着，开发者只需要修改少量的配置代码，就可以在符合 Opentracing 标准的链路追踪系统之间自由切换。
数据模型SpanSpan 是一条链路追踪的基本组成要素，一个 Span 表示一个独立的工作单元，比如一次函数调用，一次 RPC 请求，Span 会记录一些基本要素：

操作&#x2F;行为名称
开始时间
结束时间
Tags(一组零个或多个 key: ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2021/09/23/books/involution-felicity/" title="「在一个内卷的时代，我们该如何谈论幸福」课堂笔记"><img class="post_bg" src="https://graph.linganmin.cn/210923/af9c4e0ac4793f542a6f50220a229be1?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="「在一个内卷的时代，我们该如何谈论幸福」课堂笔记"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/09/23/books/involution-felicity/" title="「在一个内卷的时代，我们该如何谈论幸福」课堂笔记">「在一个内卷的时代，我们该如何谈论幸福」课堂笔记</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-09-23T14:03:51.000Z" title="发表于 2021-09-23 22:03:51">2021-09-23</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E8%AF%BB%E4%B9%A6/">读书</a></span></div><div class="content">整堂课的“题”，老师整体上是基于罗曼罗兰的这句话展开的：

世界上只有一种真正的英雄主义，就是当你认清了生活的真相后，你仍然还热爱它。

为什么会内卷
内卷是一种在资源有限，且没有增量资源的情况下，整个社会对存量资源争夺加剧的一种社会现象。

资源有限，对资源的需求无限。
所以内卷出来之后出来一个词，就是躺平。我卷不动了肯定就躺了，我不想跟你争夺了，我就要躺平啊。
高校里的编制为什么那么困难，编制就是那么点有限的，争夺这些编制的人多着呢，他不提高要求的话怎么筛选啊。
只不过是因为时间的变化、社会的发展，对我们每个人的要求越来越高了。
鸡娃现象
是我们的内心不够坚定，被这种教育的洪流给带跑了。
幸福为什么那么难生物学家在解析幸福的时候是把这个问题指向动物和人类的身体机制的。生物学家举了一个例子：

大马哈鱼，溯江而上，产卵而死。我们身上的这种身体机制为了繁衍连母体的生命都可以牺牲，幸福怎么可以被称为重要的追求呢。

自然选择出的生理机制只是服务于人类生存的繁衍，根本就没有增加这种幸福快乐的考虑。然而,我们产生了一种错觉，就是我们小的时候很幸福呀。人类在幼儿阶段是最明显的一个动物性的阶段。 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2021/09/22/k8s/nginx-ingress-install/" title="Kubernetes 集群部署最新版 Ingress-Nginx"><img class="post_bg" src="https://graph.linganmin.cn/210922/88f2bb6a988224d79d9f6cdf1edce170?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kubernetes 集群部署最新版 Ingress-Nginx"></a></div><div class="recent-post-info"><a class="article-title" href="/2021/09/22/k8s/nginx-ingress-install/" title="Kubernetes 集群部署最新版 Ingress-Nginx">Kubernetes 集群部署最新版 Ingress-Nginx</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2021-09-22T14:40:34.000Z" title="发表于 2021-09-22 22:40:34">2021-09-22</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Kubernetes/">Kubernetes</a></span></div><div class="content">简介
ingress-nginx 是 Kubernetes 的入口控制器，使用 Nginx 作为反向代理和负责均衡器。

如引用所写的那样，ingress-nginx 其实就是使用 Nginx 作为 Kubernetes 集群入口的反向代理和均衡器。对于 Nginx 我们应该都很熟悉，或者说至少不陌生。那么什么是ingress呢。
什么是 Ingress
Ingress 是对集群中服务的外部访问进行管理的 API 对象，典型的访问方式是 HTTP。Ingress 公开了从集群外部到集群内部服务的 HTTP 和 HTTPS 路由。流量路由由 Ingress 资源定义的规则控制。

下图是一个将所有流量发送到同一个 Service 的简单 Ingress 示例：

Ingress 资源和所有其他 Kubernetes 资源一样，Ingress 需要使用apiVersion、kind、metadata字段，Ingress 通常使用注解（annotations）来配置一些选项，具体取决于 Ingress 控制器，不同的 Ingress 控制器支持不同的注解。
Ingress 规约 提供了配置负 ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/#content-inner">4</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://graph.linganmin.cn/200118/06177d8b92c66f2c3a6fd82cca544f51" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">安小下同学</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">40</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/linganmin" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:saboranmin@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.weibo.com/u/1793963601" target="_blank" title="Weibo"><i class="fab fa-weibo"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">来日方短，道阻且长，好好吃饭，保重身体，任寅虎年快乐 ^_^</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/12/08/docker/log-fluentd/" title="使用 Fluentd + ElasticSearch 搭建 docker stdout 日志解决方案"><img src="https://graph.linganmin.cn/220918/09a22a20c3b33f091ac17d50dba2e259?x-oss-process=image/format,webp/quality,q_60" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 Fluentd + ElasticSearch 搭建 docker stdout 日志解决方案"/></a><div class="content"><a class="title" href="/2022/12/08/docker/log-fluentd/" title="使用 Fluentd + ElasticSearch 搭建 docker stdout 日志解决方案">使用 Fluentd + ElasticSearch 搭建 docker stdout 日志解决方案</a><time datetime="2022-12-08T14:40:34.000Z" title="发表于 2022-12-08 22:40:34">2022-12-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/09/docker/scrolling/" title="使用 Docker Compose 实现滚动更新部署"><img src="https://graph.linganmin.cn/221209/61c7c60a1231bd6f951d4db4f6330460?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 Docker Compose 实现滚动更新部署"/></a><div class="content"><a class="title" href="/2022/09/09/docker/scrolling/" title="使用 Docker Compose 实现滚动更新部署">使用 Docker Compose 实现滚动更新部署</a><time datetime="2022-09-09T14:40:34.000Z" title="发表于 2022-09-09 22:40:34">2022-09-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/08/08/docker/log-collect/" title="使用 log-pilot + elk 搭建 docker stdout 日志解决方案"><img src="https://graph.linganmin.cn/211107/bf81612871634692c7c423dcc5aef292?x-oss-process=image/format,webp/quality,q_60" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 log-pilot + elk 搭建 docker stdout 日志解决方案"/></a><div class="content"><a class="title" href="/2022/08/08/docker/log-collect/" title="使用 log-pilot + elk 搭建 docker stdout 日志解决方案">使用 log-pilot + elk 搭建 docker stdout 日志解决方案</a><time datetime="2022-08-08T14:40:34.000Z" title="发表于 2022-08-08 22:40:34">2022-08-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/29/k8s/k8s-sys/" title="搭建基于 Kubernetes 生产可用的日志和监控系统"><img src="https://graph.linganmin.cn/220529/b208e0a803bbec39eab9007b774f2d92?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="搭建基于 Kubernetes 生产可用的日志和监控系统"/></a><div class="content"><a class="title" href="/2022/05/29/k8s/k8s-sys/" title="搭建基于 Kubernetes 生产可用的日志和监控系统">搭建基于 Kubernetes 生产可用的日志和监控系统</a><time datetime="2022-05-29T14:40:34.000Z" title="发表于 2022-05-29 22:40:34">2022-05-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/08/golang/memory-gc-escape/" title="浅析 Golang 内存机制（内存分配、GC、内存逃逸）"><img src="https://graph.linganmin.cn/220308/d4ae2041db5705ff090a064e92e12d78?x-oss-process=image/format,webp/quality,q_60" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="浅析 Golang 内存机制（内存分配、GC、内存逃逸）"/></a><div class="content"><a class="title" href="/2022/03/08/golang/memory-gc-escape/" title="浅析 Golang 内存机制（内存分配、GC、内存逃逸）">浅析 Golang 内存机制（内存分配、GC、内存逃逸）</a><time datetime="2022-03-08T14:30:20.000Z" title="发表于 2022-03-08 22:30:20">2022-03-08</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            <a class="card-more-btn" href="/categories/" title="查看更多">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Database/"><span class="card-category-list-name">Database</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Frchitecture/"><span class="card-category-list-name">Frchitecture</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Golang/"><span class="card-category-list-name">Golang</span><span class="card-category-list-count">9</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Kubernetes/"><span class="card-category-list-name">Kubernetes</span><span class="card-category-list-count">13</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Middleware/"><span class="card-category-list-name">Middleware</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Native/"><span class="card-category-list-name">Native</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E6%97%85%E8%A1%8C/"><span class="card-category-list-name">旅行</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E7%A1%AC%E4%BB%B6/"><span class="card-category-list-name">硬件</span><span class="card-category-list-count">1</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Android/" style="font-size: 1.1em; color: #999">Android</a> <a href="/tags/Cache/" style="font-size: 1.1em; color: #999">Cache</a> <a href="/tags/Consul/" style="font-size: 1.1em; color: #999">Consul</a> <a href="/tags/Docker/" style="font-size: 1.5em; color: #99a9bf">Docker</a> <a href="/tags/Gin/" style="font-size: 1.1em; color: #999">Gin</a> <a href="/tags/Golang/" style="font-size: 1.37em; color: #99a4b2">Golang</a> <a href="/tags/Jeager/" style="font-size: 1.1em; color: #999">Jeager</a> <a href="/tags/Kubernetes/" style="font-size: 1.43em; color: #99a6b9">Kubernetes</a> <a href="/tags/MQ/" style="font-size: 1.17em; color: #999c9f">MQ</a> <a href="/tags/Mac/" style="font-size: 1.1em; color: #999">Mac</a> <a href="/tags/MySQL/" style="font-size: 1.17em; color: #999c9f">MySQL</a> <a href="/tags/Opentracing/" style="font-size: 1.1em; color: #999">Opentracing</a> <a href="/tags/PHP/" style="font-size: 1.1em; color: #999">PHP</a> <a href="/tags/Redis/" style="font-size: 1.1em; color: #999">Redis</a> <a href="/tags/%E4%B8%80%E5%B9%B4%E5%8F%88%E4%B8%80%E5%B9%B4/" style="font-size: 1.23em; color: #999ea6">一年又一年</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 1.17em; color: #999c9f">中间件</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 1.1em; color: #999">分布式</a> <a href="/tags/%E6%8B%BE%E9%81%97/" style="font-size: 1.3em; color: #99a1ac">拾遗</a> <a href="/tags/%E6%8C%89%E6%97%B6%E9%95%BF%E5%A4%A7/" style="font-size: 1.1em; color: #999">按时长大</a> <a href="/tags/%E6%91%84%E5%BD%B1/" style="font-size: 1.1em; color: #999">摄影</a> <a href="/tags/%E6%97%85%E8%A1%8C/" style="font-size: 1.17em; color: #999c9f">旅行</a> <a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 1.1em; color: #999">架构</a> <a href="/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/" style="font-size: 1.1em; color: #999">碎碎念</a> <a href="/tags/%E8%AF%BB%E4%B8%87%E5%8D%B7%E4%B9%A6/" style="font-size: 1.17em; color: #999c9f">读万卷书</a></div></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">40</div></div><div class="webinfo-item"><div class="item-name">已运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2018-12-31T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2022-12-09T12:36:52.212Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2022 By 安小下同学</div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/"><img style="height:10px" src="https://img.alicdn.com/imgextra/i3/O1CN012VJ8YA22JOP4XNnCr_!!6000000007099-2-tps-20-20.png">苏ICP备16006718号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/pluginsSrc/medium-zoom/dist/medium-zoom.min.js"></script><div class="js-pjax"><script>function subtitleType () {
  if (true) { 
    window.typed = new Typed("#subtitle", {
      strings: ["诗和远方代替不了一日三餐，你的信念终究需要一个栖身之所。","好的生活应该是平静的生活，生活的理想就是理想的生活。","写代码，不含糖🍬"],
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50
    })
  } else {
    document.getElementById("subtitle").innerHTML = '诗和远方代替不了一日三餐，你的信念终究需要一个栖身之所。'
  }
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('/pluginsSrc/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>