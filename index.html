<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>小下同学 - 找不到北，就多看东西</title><meta name="author" content="安小下同学"><meta name="copyright" content="安小下同学"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="小下同学">
<meta property="og:url" content="https://blog.linganmin.cn/index.html">
<meta property="og:site_name" content="小下同学">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://graph.linganmin.cn/200118/06177d8b92c66f2c3a6fd82cca544f51">
<meta property="article:author" content="安小下同学">
<meta property="article:tag" content="安小下同学,闵令安,令安,小下,亲爱的安小下同学,小下同学,小小小下,前端,js,jquery,javascript,html5,开发者,程序猿,程序媛,极客,编程,代码,开源,IT网站,Developer,Programmer,Coder,Geek,html,css,css3,用户体验,php,laravel,golang,phper,docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://graph.linganmin.cn/200118/06177d8b92c66f2c3a6fd82cca544f51"><link rel="shortcut icon" href="https://graph.linganmin.cn/201206/fe9c5e8ef76354659ab9c6c8764d6f3d"><link rel="canonical" href="https://blog.linganmin.cn/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="KrvBZb2kkH"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/pluginsSrc/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b4e74da1cb3c8b4a65da55116b8cba6f";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.min.js',
      css: '/pluginsSrc/flickr-justified-gallery/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '小下同学',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-12-15 12:45:27'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://graph.linganmin.cn/200118/06177d8b92c66f2c3a6fd82cca544f51" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">45</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://graph.linganmin.cn/200120/81525dc7a1a92645199b36b2e20cc2c8?x-oss-process=image/format,webp/quality,q_40')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">小下同学</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">小下同学</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/linganmin" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:saboranmin@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.weibo.com/u/1793963601" target="_blank" title="Weibo"><i class="fab fa-weibo"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/posts/41948abf/" title="基于 ChatGLM3-6B 的微调实践"><img class="post_bg" src="https://graph.linganmin.cn/231214/a8efd72bfa4ccbbf13ea1ae91dc334ce?x-oss-process=image/format,webp/quality,q_60" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于 ChatGLM3-6B 的微调实践"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/41948abf/" title="基于 ChatGLM3-6B 的微调实践">基于 ChatGLM3-6B 的微调实践</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-12-14T12:37:27.282Z" title="发表于 2023-12-14 20:37:27">2023-12-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/LLM/">LLM</a></span></div><div class="content">因为一些特殊的原因需要使用到大模型，然后便尝试微调清华大学开源的大模型ChatGLM3-6B，本文记录之。
ChatGLM3是智谱AI和清华大学 KEG 实验室联合发布的新一代对话预训练模型。详细文档参考ChatGLM3官网仓库。
环境
硬件
CPU
8C


内存
32G


GPU
NVIDIA V100 *1（16G）




系统
ubuntu22.04


软件
pytorch2.1.0
tensorflow2.14.0
tensorflow-gpu&#x3D;&#x3D;2.8.0
Python3.10
cu118



ChatGLM3 部署下载仓库12git clone https://github.com/THUDM/ChatGLM3cd ChatGLM3

安装依赖1pip install -r requirements.txt

下载模型因为众所周知的原因，国内从Hugging Face下载模型会相当慢，所以我们选择从国内的modelscope下载。


1git clone https://www.modelscope.cn/ZhipuAI/chatglm3-6 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/2f918798/" title="基于 cert-manage 对阿里云域名自动签发 TLS(https) 证书"><img class="post_bg" src="https://graph.linganmin.cn/231004/bf4bff6c40c7ab4fc47e037b810b58cb?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于 cert-manage 对阿里云域名自动签发 TLS(https) 证书"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/2f918798/" title="基于 cert-manage 对阿里云域名自动签发 TLS(https) 证书">基于 cert-manage 对阿里云域名自动签发 TLS(https) 证书</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-10-04T12:10:34.000Z" title="发表于 2023-10-04 20:10:34">2023-10-04</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="content">概述使用 HTTPS 需要向权威机构申请证书，并且需要付出一定的成本，如果需求数量多，则开支也相对增加。 cert-manager 是 Kubernetes 上的全能证书管理工具，支持利用 cert-manager 基于 ACME 协议与 Let&#39;s Encrypt 签发免费证书并为证书自动续期，实现永久免费使用证书。
工作原理
证书签发Let&#39;s Encrypt 是一个非营利性的证书颁发机构（Certificate Authority，简称 CA），旨在提供免费的 SSL/TLS 证书，以帮助网站和网络应用实现加密通信。SSL&#x2F;TLS 证书是一种数字证书，用于加密数据传输以确保数据在客户端和服务器之间的安全性和隐私性。通过使用 SSL/TLS 证书，网站可以实现 HTTPS 连接，从而保护用户的数据免受窃听和篡改的威胁。
以下是 Let&#39;s Encrypt 的一些关键特点和信息：

免费证书: Let&#39;s Encrypt 提供免费的 SSL&#x2F;TLS 证书，使网站所有者能够轻松地将其网站升级为安全的 HTTPS 连接，无需支付昂贵的证 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/67196ad2/" title="Chapter One Of Learn LangChain 快速入门"><img class="post_bg" src="https://graph.linganmin.cn/230727/e64f88e4a73453b4beced9914f69cfaa?x-oss-process=image/format,webp/quality,q_60" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Chapter One Of Learn LangChain 快速入门"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/67196ad2/" title="Chapter One Of Learn LangChain 快速入门">Chapter One Of Learn LangChain 快速入门</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-07-25T01:27:26.983Z" title="发表于 2023-07-25 09:27:26">2023-07-25</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/LLM/">LLM</a></span></div><div class="content">安装依赖1pip install langchain

环境设置使用LangChain通常需要与一个或多个模型提供者、数据存储、API等集成。在下面的示例中，我们将使用OpenAI的模型 API。
安装 openapi 依赖包1pip install openai

设置环境通过接口访问OpenAI需要一个密钥，你可以通过创建一个账户然后绑定支持的信用卡（需要美国信用卡）就可以生成自己的密钥了, 点击进入 OpenAI API Keys 管理，参见下图：


123import osos.environ[&quot;OPENAI_API_KEY&quot;] = &quot;...&quot;

如果你不想设置环境变量，可以在初始化OpenAI的LLM时，直接通过名为openai_api_key的参数传递秘钥
123from langchain.llms import OpenAIllm = OpenAI(openai_api_key=&quot;...&quot;)

构建应用程序LangChain提供了许多可用于构建语言模型应用程序的模块，模块可以在简单的应用程序中独立使用，也可以 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/86b0ac2d/" title="Chapter Zero Of Learn LangChain"><img class="post_bg" src="https://graph.linganmin.cn/230724/883c7d735b53fe65141cd7bc53314b86?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Chapter Zero Of Learn LangChain"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/86b0ac2d/" title="Chapter Zero Of Learn LangChain">Chapter Zero Of Learn LangChain</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-07-24T01:35:55.690Z" title="发表于 2023-07-24 09:35:55">2023-07-24</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/LLM/">LLM</a></span></div><div class="content">LangChain是什么LangChain是一个强大的框架，旨在帮助开发人员使用语言模型构建端到端的应用程序。它提供了一套工具、组件和接口，可简化创建由大型语言模型 (LLM) 和聊天模型提供支持的应用程序的过程。
简单来说，可以理解LangChain相当于开源版的LLM插件，它提供了丰富的大语言模型工具，支持在开源模型的基础上快速增强模型的能力。LangChain可以轻松管理与语言模型的交互，将多个组件链接在一起，并集成额外的资源，例如 API 和数据库。
LangChain有哪些模块LangChain为以下模块提供标准的、可扩展的接口和外部集成。
Model I&#x2F;O
任何语言模型应用程序的核心都是模型，LangChain提供了与任何语言模型交互的构建模块。


Prompt
模板化、动态选择和管理模型输入


Language models
通过通用接口调用语言模型


Output parsers
从模型输出中提取信息




Data connection
许多LLM需要访问用户特殊数据，但这部分数据不属于集群训练的一部分，LangChain提供了通过加载,转换,存储 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/57dfec22/" title="kube-prometheus-stack usage"><img class="post_bg" src="https://graph.linganmin.cn/230501/b1800426df2eeba8c39b3e1afcb43802?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="kube-prometheus-stack usage"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/57dfec22/" title="kube-prometheus-stack usage">kube-prometheus-stack usage</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-04-30T03:37:02.800Z" title="发表于 2023-04-30 11:37:02">2023-04-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="content">Environment
Kubernetes 集群
需要一个已经部署完成且可用的Kubernetes 1.16+集群。


Helm
helm version v3+



Steps
添加 helm 仓库
12helm repo add prometheus-community https://prometheus-community.github.io/helm-chartshelm repo update

将仓库拉取到本地
1helm pull prometheus-community/kube-prometheus-stack

将拉取到的压缩包解压
12345678910tar -zxvf kube-prometheus-stack-45.8.1.tgz # kube-prometheus-stack/Chart.yaml# kube-prometheus-stack/Chart.lock# kube-prometheus-stack/values.yaml# kube-prometheus-stack/templates/NOTES.txt# kube-prometheu ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/52d6062e/" title="浅析 IPVS"><img class="post_bg" src="https://graph.linganmin.cn/230210/8a82cd11d4e6a02325560651cc836f57?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="浅析 IPVS"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/52d6062e/" title="浅析 IPVS">浅析 IPVS</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-02-10T07:49:00.930Z" title="发表于 2023-02-10 15:49:00">2023-02-10</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="content">TODOTODOTODOTODO
</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/49a0b438/" title="Linux OS 的 Init 和 Systemd"><img class="post_bg" src="https://graph.linganmin.cn/230202/45c4be216e488ead47b3373c4a04187f?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux OS 的 Init 和 Systemd"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/49a0b438/" title="Linux OS 的 Init 和 Systemd">Linux OS 的 Init 和 Systemd</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-02-02T06:55:37.169Z" title="发表于 2023-02-02 14:55:37">2023-02-02</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统</a></span></div><div class="content">什么是 Init 守护进程Init守护进程是Linux内核执行的第一个进程，它的进程ID（PID）始终是1，它的目的是初始化、管理和跟踪系统服务和守护进程，也就是说init deamon(Init 守护进程)是系统上所有进程的父进程。
什么是 InitInit（也被称为System V init或者SysVinit），它是一个初始化守护进程，创建于 1980 年。它定义了6个运行级别（系统状态）并将所有的系统服务映射到这些运行级别。这使得所有服务都会以预定义的顺序启动，只有当顺序中的当前脚本执行完成或者卡主超时时才会执行下一个脚本。除了执行超时导致无法预期的等待之外，串行的启动服务也会使得系统初始化过程效率低下且相对较慢。
什么是 SystemdSystemd(system daemon)是现代系统使用的init守护进程，它并行的启动系统服务，从而消除不必要的延迟并加快初始化进程。systemd通过使用Unit Dependencies来定义一个服务是否想要&#x2F;需要依赖其他服务才能运行，使用Unit Order来定义一个服务是否需要在它之前&#x2F;之后启动。可以使用syst ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/c62b22dc/" title="使用 Kubeadm 部署 Kubernetes 集群（基于 Containerd 运行时）"><img class="post_bg" src="https://graph.linganmin.cn/230201/236bd147e42b9a2fcd31784975f76399?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 Kubeadm 部署 Kubernetes 集群（基于 Containerd 运行时）"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/c62b22dc/" title="使用 Kubeadm 部署 Kubernetes 集群（基于 Containerd 运行时）">使用 Kubeadm 部署 Kubernetes 集群（基于 Containerd 运行时）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-02-01T06:32:12.228Z" title="发表于 2023-02-01 14:32:12">2023-02-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="content">基础知识CRI、Containerd、OCI、runcCRICRI(Container Runtime Interface)是Kubernetes定义的接口，定义了如何操作容器和镜像的统一规范。Kubernetes 尽量不关心您使用哪个容器运行时。 它只需要能够向它发送指令——为Pod创建容器、终止它们等等。 这就是CRI的用武之地。CRI 是对现在或将来可能存在的任何类型的容器运行时的抽象。 所以 CRI 让 Kubernetes 更容易使用不同的容器运行时。 CRI API描述了Kubernetes如何与任何运行时交互，而不是Kubernetes项目需要单独添加对每个运行时的支持。 只要给定的容器运行时实现了CRI API，运行时就可以随心所欲地创建和启动容器。

Containerdcontainerd是一个来自Docker的高级容器运行时，并实现了CRI规范。它是从Docker项目中分离出来，之后containerd被捐赠给云原生计算基金会（CNCF）为容器社区提供创建新容器解决方案的基础。
所以Docker自己在内部使用containerd，当你安装Docker时也会安装co ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/posts/4f614365/" title="Kubernetes 集群部署之网段划分"><img class="post_bg" src="https://graph.linganmin.cn/230201/1121c70cca031f2591b48ce72261dedc?x-oss-process=image/format,webp/quality,q_10" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kubernetes 集群部署之网段划分"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/4f614365/" title="Kubernetes 集群部署之网段划分">Kubernetes 集群部署之网段划分</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-02-01T03:53:34.324Z" title="发表于 2023-02-01 11:53:34">2023-02-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="content">Kubernetes 集群部署会涉及到如下三个网段

宿主机网段
准备安装 Kubernetes 集群的服务器的内网网段


POD 网段
Kubernetes 中部署的 POD 的网段


Service 网段
Kubernetes 中部署的 Service 的网段



需要注意的的是在部署Kubernetes的时候，这三个网段之间不能有任何的交叉。比如，如果宿主机的网段是172.16.168.135/12，那么Service或Pod的网段就不能在172.16.0.1~172.31.255.254之间。
所以一般的推荐是，三个网段的第一位就不要重复，比如宿主机的网段如果是172开头，那么Service和Pod就不要用172打头的网段，这样不近可以避免网段冲突，还可以减去计算的步骤。

A 类地址子网掩码最小为8B 类地址子网掩码最小为16C 类地址子网掩码最小为24
为了方便POD数量的扩展，应该给POD设置B类或A类地址，因为C类最多只有254个可用IP。
</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/posts/e11179c6/" title="使用 Fluentd + ElasticSearch 搭建 docker stdout 日志解决方案"><img class="post_bg" src="https://graph.linganmin.cn/220918/09a22a20c3b33f091ac17d50dba2e259?x-oss-process=image/format,webp/quality,q_60" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 Fluentd + ElasticSearch 搭建 docker stdout 日志解决方案"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/e11179c6/" title="使用 Fluentd + ElasticSearch 搭建 docker stdout 日志解决方案">使用 Fluentd + ElasticSearch 搭建 docker stdout 日志解决方案</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-12-08T14:40:34.000Z" title="发表于 2022-12-08 22:40:34">2022-12-08</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a></span></div><div class="content">整体架构如下图，容器产生的 stdout 日志通过 Fluentd 分发到 ElasticSearch 的不同索引，然后通过 Kibana 进行可视化查询、搜索等。

部署ElasticSearch &amp; Kibana笔者使用的是docker-compose方式部署的 ES 集群和 Kibana，参考文件如下：
目录结构12345&gt;ls -aldrwxr-xr-x 2 root root 4096 9月  18 14:45 .drwxr-xr-x 7 root root 4096 9月  15 14:50 ..-rw-r--r-- 1 root root 7956 9月  16 14:18 docker-compose.yaml-rw-r--r-- 1 root root  776 9月  16 13:43 .env

.env 配置文件内容123456789101112131415161718192021222324252627282930# 此处为 elastic 用户设置密码，至少6个字符ELASTIC_PASSWORD=# 此处设置kibana密码KIBANA_PA ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/#content-inner">5</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://graph.linganmin.cn/200118/06177d8b92c66f2c3a6fd82cca544f51" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">安小下同学</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">45</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/linganmin" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:saboranmin@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.weibo.com/u/1793963601" target="_blank" title="Weibo"><i class="fab fa-weibo"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">来日方短、道阻且长；好好吃饭，好好睡觉、保重身体、好好生活，开心快乐 ^_^</div></div><div class="sticky_layout"><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/Channel/" style="font-size: 1.1em; color: #999">Channel</a> <a href="/tags/Consul/" style="font-size: 1.1em; color: #999">Consul</a> <a href="/tags/Deployment/" style="font-size: 1.1em; color: #999">Deployment</a> <a href="/tags/Docker/" style="font-size: 1.34em; color: #99a3b0">Docker</a> <a href="/tags/DockerCompose/" style="font-size: 1.18em; color: #999ca1">DockerCompose</a> <a href="/tags/DokerCompose/" style="font-size: 1.1em; color: #999">DokerCompose</a> <a href="/tags/Feed%E6%B5%81/" style="font-size: 1.1em; color: #999">Feed流</a> <a href="/tags/Fluent/" style="font-size: 1.18em; color: #999ca1">Fluent</a> <a href="/tags/GC/" style="font-size: 1.1em; color: #999">GC</a> <a href="/tags/GMP/" style="font-size: 1.1em; color: #999">GMP</a> <a href="/tags/Gin%E6%A1%86%E6%9E%B6/" style="font-size: 1.1em; color: #999">Gin框架</a> <a href="/tags/Golang/" style="font-size: 1.42em; color: #99a6b7">Golang</a> <a href="/tags/Goroutine/" style="font-size: 1.1em; color: #999">Goroutine</a> <a href="/tags/Grafana/" style="font-size: 1.1em; color: #999">Grafana</a> <a href="/tags/Helm/" style="font-size: 1.1em; color: #999">Helm</a> <a href="/tags/IPVS/" style="font-size: 1.1em; color: #999">IPVS</a> <a href="/tags/Ingress/" style="font-size: 1.1em; color: #999">Ingress</a> <a href="/tags/K8S%E6%8E%A2%E9%92%88/" style="font-size: 1.1em; color: #999">K8S探针</a> <a href="/tags/Kafka/" style="font-size: 1.1em; color: #999">Kafka</a> <a href="/tags/Kubeadm/" style="font-size: 1.18em; color: #999ca1">Kubeadm</a> <a href="/tags/Kubernetes/" style="font-size: 1.5em; color: #99a9bf">Kubernetes</a> <a href="/tags/MacOS/" style="font-size: 1.1em; color: #999">MacOS</a> <a href="/tags/MySQL/" style="font-size: 1.1em; color: #999">MySQL</a> <a href="/tags/Opentracing/" style="font-size: 1.1em; color: #999">Opentracing</a> <a href="/tags/POD/" style="font-size: 1.1em; color: #999">POD</a> <a href="/tags/Prometheus/" style="font-size: 1.18em; color: #999ca1">Prometheus</a> <a href="/tags/Redis/" style="font-size: 1.1em; color: #999">Redis</a> <a href="/tags/TLS/" style="font-size: 1.1em; color: #999">TLS</a> <a href="/tags/Traefik/" style="font-size: 1.1em; color: #999">Traefik</a> <a href="/tags/%E4%B8%80%E5%B9%B4%E5%8F%88%E4%B8%80%E5%B9%B4/" style="font-size: 1.26em; color: #999fa8">一年又一年</a> <a href="/tags/%E4%B8%87%E5%8D%B7%E4%B9%A6/" style="font-size: 1.18em; color: #999ca1">万卷书</a> <a href="/tags/%E4%B8%8A%E6%B5%B7/" style="font-size: 1.18em; color: #999ca1">上海</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 1.26em; color: #999fa8">中间件</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 1.1em; color: #999">分布式</a> <a href="/tags/%E5%A4%A7%E9%99%88%E5%B2%9B/" style="font-size: 1.1em; color: #999">大陈岛</a> <a href="/tags/%E6%91%84%E5%BD%B1/" style="font-size: 1.1em; color: #999">摄影</a> <a href="/tags/%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86/" style="font-size: 1.26em; color: #999fa8">日志收集</a> <a href="/tags/%E6%9E%B8%E6%9D%9E%E5%B2%9B/" style="font-size: 1.1em; color: #999">枸杞岛</a> <a href="/tags/%E6%BA%90%E7%A0%81/" style="font-size: 1.1em; color: #999">源码</a> <a href="/tags/%E6%BB%9A%E5%8A%A8%E6%9B%B4%E6%96%B0/" style="font-size: 1.1em; color: #999">滚动更新</a></div></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">45</div></div><div class="webinfo-item"><div class="item-name">已运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2018-12-31T16:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">57.3k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2023-12-15T04:45:27.113Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div><div class="card-widget user-map" id="user-map"><div class="item-headline"><i class="fas fa-heartbeat"></i><span>访客地图</span></div><div class="item-content"><script type="text/javascript" id="clstr_globe" src="//clustrmaps.com/globe.js?d=a7gP3sFK2EWGUn4ldSm-DEYh1XLHHOKeuRBrF9Lf-g4"></script></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2023 By 安小下同学</div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/"><img style="height:10px" src="https://img.alicdn.com/imgextra/i3/O1CN012VJ8YA22JOP4XNnCr_!!6000000007099-2-tps-20-20.png">苏ICP备16006718号</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/pluginsSrc/medium-zoom/dist/medium-zoom.min.js"></script><div class="js-pjax"><script>function subtitleType () {
  if (true) { 
    window.typed = new Typed("#subtitle", {
      strings: ["诗和远方代替不了一日三餐，你的信念终究需要一个栖身之所。","好的生活应该是平静的生活，生活的理想就是理想的生活。","写代码，不含糖🍬"],
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50
    })
  } else {
    document.getElementById("subtitle").innerHTML = '诗和远方代替不了一日三餐，你的信念终究需要一个栖身之所。'
  }
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('/pluginsSrc/typed.js/lib/typed.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>